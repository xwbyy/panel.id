<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP and Geolocation Tracker</title>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: 'Courier New', Courier, monospace;
            background: #0f0f0f;
            color: #33ff33;
            transition: background 0.5s, color 0.5s;
        }
        #map {
            height: 60%;
            transition: height 0.5s;
        }
        #info {
            padding: 20px;
            text-align: center;
        }
        #ip-input {
            background: black;
            color: #33ff33;
            border: 1px solid #33ff33;
            padding: 10px;
            width: 60%;
            margin-right: 10px;
        }
        #track-button, #redeem-button, #export-button, #dark-mode-toggle {
            background: #33ff33;
            color: black;
            border: 1px solid #33ff33;
            padding: 10px 20px;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.5s, color 0.5s;
        }
        #loading {
            display: none;
            margin-top: 10px;
            color: #ff3333;
        }
        pre {
            text-align: left;
            white-space: pre-wrap;
        }
        footer {
            text-align: center;
            padding: 10px;
            background: #0f0f0f;
            color: #33ff33;
            border-top: 1px solid #33ff33;
            transition: background 0.5s, color 0.5s;
        }
        @keyframes blink {
            50% { opacity: 0; }
        }
        #loading::after {
            content: ' _';
            animation: blink 1s infinite;
        }
        #redeem-sidebar {
            display: none;
            position: fixed;
            right: 0;
            top: 0;
            width: 300px;
            height: 100%;
            background: #0f0f0f;
            border-left: 1px solid #33ff33;
            padding: 20px;
            transition: transform 0.3s ease-in-out;
        }
        #redeem-sidebar.show {
            display: block;
            transform: translateX(0);
        }
        #redeem-sidebar.hide {
            transform: translateX(100%);
        }
        #remaining-limit {
            margin-top: 10px;
        }
        .custom-popup .leaflet-popup-content-wrapper {
            background: #0f0f0f;
            border: 1px solid #33ff33;
        }
        .custom-popup .leaflet-popup-tip-container {
            display: none;
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <div id="info">
        <h2>IP and Geolocation Tracker</h2>
        <input type="text" id="ip-input" placeholder="Enter IP address">
        <button id="track-button" onclick="trackIP()">Track IP</button>
        <p id="loading">Loading</p>
        <pre id="ip-info">Enter an IP address to start tracking</pre>
        <button id="redeem-button" onclick="toggleRedeemSidebar()">Redeem Code</button>
        <button id="export-button" onclick="exportData()">Export Data</button>
        <button id="dark-mode-toggle" onclick="toggleDarkMode()">Toggle Dark Mode</button>
        <div id="remaining-limit">Remaining Limit: <span id="user-limit">5</span></div>
    </div>
    <div id="map"></div>
    <div id="redeem-sidebar" class="hide">
        <h3>Redeem Code</h3>
        <input type="text" id="redeem-input" placeholder="Enter redeem code">
        <button onclick="redeemCode()">Redeem</button>
    </div>
    <footer>&copy; 2024 Vynaa Valerie. All rights reserved.</footer>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        let map;
        let userLimit = localStorage.getItem('userLimit') ? parseInt(localStorage.getItem('userLimit')) : 5;
        let redeemedCodes = new Set(JSON.parse(localStorage.getItem('redeemedCodes')) || []);
        let lookupData = JSON.parse(localStorage.getItem('lookupData')) || [];
        let darkMode = localStorage.getItem('darkMode') === 'true';

        function initializeMap() {
            map = L.map('map').setView([0, 0], 2);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
            }).addTo(map);
        }

        function updateUserLimitDisplay() {
            document.getElementById('user-limit').textContent = userLimit;
        }

        function trackIP() {
            if (userLimit <= 0) {
                alert('User limit reached. Please wait for the limit to reset.');
                return;
            }

            const ip = document.getElementById('ip-input').value;
            if (!ip) {
                alert('Please enter a valid IP address');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('ip-info').innerHTML = '';

            fetch(`https://ipapi.co/${ip}/json`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('loading').style.display = 'none';

                    if (data.error) {
                        document.getElementById('ip-info').innerHTML = 'Error fetching IP information';
                        return;
                    }

                    const info = `
Alamat IP: ${data.ip}
Kota: ${data.city}
Provinsi: ${data.region}
Negara: ${data.country_name}
ISP: ${data.org}
Jaringan: ${data.network}
Versi: ${data.version}
Kode Provinsi: ${data.region_code}
Kode Negara: ${data.country_code}
Kode Negara ISO3: ${data.country_code_iso3}
Ibu Kota Negara: ${data.country_capital}
TLD Negara: ${data.country_tld}
Kode Benua: ${data.continent_code}
Kode Pos: ${data.postal ? data.postal : 'N/A'}
Latitude: ${data.latitude}
Longitude: ${data.longitude}
Zona Waktu: ${data.timezone}
Offset UTC: ${data.utc_offset}
Kode Panggilan Negara: ${data.country_calling_code}
Mata Uang: ${data.currency}
Nama Mata Uang: ${data.currency_name}
Bahasa: ${data.languages}
Luas Negara: ${data.country_area}
Populasi Negara: ${data.country_population}
ASN: ${data.asn}

[Link GPS Lokasi](https://www.google.com/maps/search/?api=1&query=${data.latitude},${data.longitude})
`;

                    document.getElementById('ip-info').textContent = info;

                    map.setView([data.latitude, data.longitude], 13);

                    L.marker([data.latitude, data.longitude], { className: 'custom-popup' }).addTo(map)
                        .bindPopup(`IP: ${data.ip}<br>Latitude: ${data.latitude}<br>Longitude: ${data.longitude}`)
                        .openPopup();

                    userLimit--;
                    updateUserLimitDisplay();
                    localStorage.setItem('userLimit', userLimit);

                    lookupData.push(data);
                    localStorage.setItem('lookupData', JSON.stringify(lookupData));
                })
                .catch(error => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('ip-info').innerHTML = 'Error fetching IP information';
                    console.error('Error:', error);
                });
        }

        function toggleRedeemSidebar() {
            const sidebar = document.getElementById('redeem-sidebar');
            sidebar.classList.toggle('show');
            sidebar.classList.toggle('hide');
        }

        function redeemCode() {
            const codeInput = document.getElementById('redeem-input').value.toLowerCase();
            if (redeemedCodes.has(codeInput)) {
                alert('Invalid or already redeemed code.');
                return;
            }

            const validCodes = ['vynaaip', 'pina136', 'vynaadev', 'zaynn'];
            if (validCodes.includes(codeInput)) {
                redeemedCodes.add(codeInput);
                localStorage.setItem('redeemedCodes', JSON.stringify(Array.from(redeemedCodes)));

                userLimit += 20;
                updateUserLimitDisplay();
                localStorage.setItem('userLimit', userLimit);

                alert('Code redeemed successfully. Your limit has been increased by 20.');
            } else {
                alert('Invalid code.');
            }

            toggleRedeemSidebar();
        }

        function exportData() {
            const csvContent = "data:text/csv;charset=utf-8," + lookupData.map(e => Object.values(e).join(",")).join("\n");
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "ip_lookup_data.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function toggleDarkMode() {
            darkMode = !darkMode;
            localStorage.setItem('darkMode', darkMode);

            if (darkMode) {
                document.body.style.background = '#0f0f0f';
                document.body.style.color = '#33ff33';
                document.getElementById('map').style.height = '60%';
                document.getElementById('info').style.background = 'initial';
                document.getElementById('info').style.color = '#33ff33';
                document.querySelector('footer').style.background = '#0f0f0f';
                document.querySelector('footer').style.color = '#33ff33';
            } else {
                document.body.style.background = '#fff';
                document.body.style.color = '#000';
                document.getElementById('map').style.height = '70%';
                document.getElementById('info').style.background = '#f0f0f0';
                document.getElementById('info').style.color = '#000';
                document.querySelector('footer').style.background = '#f0f0f0';
                document.querySelector('footer').style.color = '#000';
            }
        }

        function resetUserLimit() {
            userLimit = 5;
            updateUserLimitDisplay();
            localStorage.setItem('userLimit', userLimit);
        }

        document.addEventListener('DOMContentLoaded', function() {
            initializeMap();
            updateUserLimitDisplay();
            setInterval(resetUserLimit, 24 * 60 * 60 * 1000); // Reset limit every 24 hours
            if (darkMode) {
                toggleDarkMode(); // Apply dark mode on page load if set
            }
        });
    </script>
</body>
</html>
